---
title: "How to use the `pupR` package"
author: "T. A. Øigård and M. Biuw"
date: "`r Sys.Date()`" 
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
    %\VignetteIndexEntry{How to use the `pupR` package}
    %\VignetteEngine{knitr::rmarkdown}
    \usepackage[utf8]{inputenc}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  
  fig.height = 5
)
```

```{r setup, include=FALSE}
library(pupR)
```
# Overview
The purpose of this vignette is to show how to use the `pupR` package for estimating the pup abundance of harp and hooded seal populations based on aerial photos. It will guide you through how to prepare and read the data, and how to estimate the pup abundance. Also there is a function for finding a correction factor to correct the estimated abundance for pups which have not been born yet or pups that have left ice based on multiple staging data. A complete analysis of a survey caried out on harp and hooded seals in 2012 in the West Ice (along the coast of Greenland) is included to demonstrate the use of this package. In the appendix each method for estimating the abundance and the method for estimating the correction factor is described (maybe add this later if needed...could also just refer to published papers.)



To load the `pupR` package type
```{r eval = TRUE}
library(pupR)
```

# Data used and how to load them

The population dynamics model use historical catch records, fecundity rates, age specific proportions of mature females, and estimates of pup production to estimate the population size trajectory. Two types of reproductive data are used in the model: information on the proportion of females that are mature at a given age (i.e., maturity ogive) and the proportion of mature females that are pregnant at a given year (i.e. fecundity rate). In this section we will describe what type of data is used, which data files are needed, and the format the various data are stored.


## Demo data
When installing the `pupR` package a demo data set is included so that one can explore how to use the package. 

<!-- The demo data is reproductive data, catch data, pup production estimates and priors used for population dynamics modelling of the harp seal population in the East Ice (White Sea). -->

To load the demo data:
```{r}
data("harpwestDemo")
```

<!-- The demo data is a list called `harpeast` containing two lists called `data` and `parameters`. The `data` list contains the data needed to fit the population dynamics model and the `parameters` list contains the parameters estimated by the model along with initial values of them. -->

```{r}
names(harpeast$data)

names(harpeast$parameters)
```

# Full data set
The latest version of the most recent data on aerial photos of the harps and hooded seal population in the West Ice has a separate GitHub repository called [HarpAndHoodedAerialSealData](https://www.github.com/NorskRegnesentral/HarpAndHoodedAerialSealData).

<!-- To download the complete data set run the following function: -->
<!-- ```{r eval=FALSE} -->
<!-- downloadData() -->
<!-- ``` -->
<!-- When you run this function you can run it as it is and you will be asked to specify a folder where the data is stored. You can even decide to create a new folder if needed. If you already have prepared a folder for where to download the data and has set working directory to this folder you should use the option `chooseFolder = FALSE`, i.e., -->
<!-- ```{r eval=FALSE} -->
<!-- downloadData(chooseFolder = FALSE) -->
<!-- ``` -->
<!-- After downloading the data repository you will have a **Data** folder and a **Scripts** folder. The **Data** folder contains the various harp and hooded seal data and the **Scripts** folder contains useful examples on how to perform a complete assessment. -->

<!-- When analyzing these data the `rSPAMM` package assumes that you are in the root folder of the downloaded data, i.e., not in the **Data** or the **Scripts** folder. -->



## Data
All data that is described below will be loaded and used to estimate the pup abundance of the harp and hooded seals from aerial strip transect data. Having the data on a strip transect format is only required by one of the estimation methods. The others are more general and can deal with different sampling formats.

The data set is divided in two parts. One part contains a file where the following information is needed in separate columns:

- Reader ID
- Photo ID
- Which transect the photo is on (not required)
- Latitude of photo
- Longitude of photo
- Altitude of the photo. Along with some known camera parameters this is used to find the size of the area covered by each photo.
- Area covered by the photo (this is only added if the size of the area covered is known but not required. Using the altitude where the photo is taken from along with the parameters this is calculated)
- Number of pups on a given photo. One separate column for each reader. Some photos are read twice and a "true" number of pups is agreed upon by the readers. This is used to correct for readers errors.
- Comments, this column you can add various comments. If some photos for some reason are to be removed then write *Remove* in this column.

**Important: The names of the various colums have been hard-coded in order to avoid trouble when loading the data. This might be changed in a future release of the package.**

The other part of the data set is the staging data. The staging data is a series of staging surveys for a period of time where we find the proportion of pups in various pre-specified stages (with known duration). The staging data can either be obtained from flying low and count the number of seals in each stage, or having land based counts. These staging data is used to estimate a correction factor used to correct for pups that has not been born yet or pups that has left the ice. For harp seal pups this factor is genenrally close to 1 as the duration of the various stages is quite long so that the likelihood of catching all the pups when carrying out the photo survey is quite high. The duration various stages of the hooded pups are much shorter so it is likely to miss some pups at the time of the photo survey. Due to this the correction factor often turns out to be significant.

To load the data set we use the `loadAndPrepareData` function. To read the data set the you need to specify the name of the survey (*survey*), the name of the data file (*fname*), wether it is harp or hooded seals or both (*population*), and various camera parameters used to calculate the length and the width (and thus the area coverered) of the photos (*CamParamLength*, *CamParamWidth*, and *CamParam*) based on the altitude the photos are taken from. These camera parameters are unique to the camera used.

This function not only loads the data but does some preparations of the data to make it ready for the estimation routines.

```{r eval=TRUE}
dataList = loadAndPrepareData(survey = "WestIce2012",
                                fname = "WestIce2012.csv",
                                population = c("harp","hood"))
```
The function writes out information of the proportion of seals

Next we correct the pup counts for readers error using the `correctReading` function, i.e., 

```{r eval=TRUE}
correctedList = correctReading(dataList = dataList)
```

## Estimating the number of pups

In this section we will show how to estimate the number of pups based on the pup counts from the aerial photos.

### The Kingsley method

We first present a method developed by Kingsley (ref). This method requires that the data is on a strip transect format. We use the `kingsley` function to estimate the pup abundance and we often estimate the pup abundance based on both the uncorrected pup counts and the corrected pup counts.

```{r eval=TRUE}
# The harp seal population
#Estimate the number of pups using the uncorrected pup counts
EstHarp = kingsley(dataList$xycord$x,
                   dataList$data$HarpFinalCounts,
                   dataList$data$Area,
                   dataList$data$Transect)

#Estimate the number of pups using readers corrected pup counts
EstHarpCorr = kingsley(correctedList$xycord$x,
                       correctedList$data$CountsHarpCorr,
                       correctedList$data$Area,
                       correctedList$data$Transect)

# The hooded seal population
#Estimate the number of pups using the uncorrected pup counts
EstHooded = kingsley(dataList$xycord$x,
                     dataList$data$HoodedFinalCounts,
                     dataList$data$Area,
                     dataList$data$Transect)


#Estimate the number of pups using readers corrected pup counts
EstHoodedCorr = kingsley(correctedList$xycord$x,
                         correctedList$data$CountsHoodedCorr,
                         correctedList$data$Area,
                         correctedList$data$Transect)
```
The output of the `kingsley` function is a data frame containing the estimated number of pups N, the standard error SE, and the coefficient of variation CV. 

When correcting for readers errors one estimate an uncertainty of the readers correction. This is obtained from either `VmeasHarp`or `VmeasHooded` in the output list from the `correctReading` function. Thus, both the Kingsley method and correcting for readers errors has an uncertainty, and to find the total uncertainty of the estimated pup abundance one need to combine these uncertainties, i.e.,

```{r eval=TRUE}
#Total uncertainty estimate of pup estimation + uncertainty of reader errors
VarHarpCorr = EstHarpCorr$SE^2+correctedList$VmeasHarp
VarHoodedCorr = EstHoodedCorr$SE^2+correctedList$VmeasHooded

```
A quick summary of the estimated number of pups with the uncertainty is:

```{r eval=TRUE, echo=TRUE}
cat("\n###############################\n")
cat("Estimated number of harp seal pups:\n")
cat(paste0("    Uncorected pup counts: N = ",EstHarp$N," (SE =",EstHarp$SE," CV = ",EstHarp$CV,")\n"))
cat(paste0("    Corrected pup counts:  N = ",EstHarpCorr$N," (SE =",round(sqrt(VarHarpCorr))," CV = ",round(100*sqrt(VarHarpCorr)/EstHarpCorr$N),")\n"))
cat("\n ------------------------------\n")
cat("Estimated number of hooded seal pups:\n")
cat(paste0("    Uncorected pup counts: N = ",EstHooded$N," (SE =",EstHooded$SE," CV = ",EstHooded$CV,")\n"))
cat(paste0("    Corrected pup counts:  N = ",EstiHooded$N," (SE =",round(sqrt(VarHoodedCorr))," CV = ",round(100*sqrt(VarHoodedCorr)/EstHoodedCorr$N),")\n"))
cat("\n###############################\n")
```

### GAM based pup abundance

In this section we present a method based on Generalized Additive Models (GAMs) to estimate the pup density over the whelping patch. From this we obtain both an estimate and a uncertainty of the pup abundance. For details of the GAM method see (ref).

To estimate the pup abundance using GAMs we use the `GAMestimate` function. As we did for the Kingsley method we estimate the pup abundance using both the uncorrected and the corrected pup counts. We can also specify for wich population to estimate the pup abundance, or both. In the example below we estimate the pup abundance for both populations.

In addition we have to specify for which distribution to use in the model. At the moment one can choose between the *Poisson-* or the *Negative binomial-* distributions, depending on the sparsity of the data. In this example we use the negative binomial distribution.

To estimate the pup abundance using uncorrected pup counts we do:

```{r eval=TRUE}
EstGAM = GAMestimate(harpcounts =
                       dataList$data$HarpFinalCounts,
                     hoodedcounts =
                       dataList$data$HoodedFinalCounts,
                     area = dataList$data$Area,
                     xycord = dataList$xycord,
                     transect = dataList$data$Transect,
                     distr = "negbin")
```

To estimate the pup abundance using corrected pup counts:

```{r eval=TRUE}
EstGAMCorr = GAMestimate(harpcounts = 
                           correctedList$data$CountsHarpCorr,
                         hoodedcounts =correctedList$data$CountsHoodedCorr,
                         area = correctedList$data$Area,
                         xycord = correctedList$xycord,
                         transect = correctedList$data$Transect,
                         distr = "negbin")
```

We could do the same, but with a Poisson distribution and then check the goodnes-off-fit for the different models. If you do that it will show that the Negative Binomial distribution is a better model due to over-dispersion.

The total uncertainty estimate of the pup abundance using GAMs using corrected pup counts is:

```{r eval=TRUE}
VarHarpGAMCorr = EstGAMCorr$SEHarpGAM^2+correctedList$VmeasHarp
VarHoodedGAMCorr = EstGAMCorr$SEHoodedGAM^2+correctedList$VmeasHooded
```


## Estimating the birth distribution - the correction factor

In this section we will see how you can estimate the correction factor to correct for pups which have not been born yet or pups that have left the ice. The correction factor is estimated from a different data set than the aerial photos. The data needed is staging data. This is obtained by flying over the whelping patch for a period of time and count the number of pups in various pre-defined age/growt stages with known length, see Appendix for details. This applies for both populations, but each population are divided in different stage classes and the length of the various stages are different. After the pups reach a certain mature stage it is assumed that the pup leaves the ice, and is thus unavailable for counting if the aerial photo survey are carried out after the pups have left the ice. Based on this data and the known length of the various stages one can estimate the date of the peak of the whelping season and through a model developed by (ref) one can estimate the number of pups on the ice at any date in the whelping season. 

As we now have estimated the birth distribution and obtained the correction factor for the date when the aerial survey was carried out we can obtain a pup abundance estimated adusted for pups that have not been born yet and pups that have left the ice. Earlier we found a total uncertainty of the estimated pup abundance (not adjusted for missing seals) when using the readers corrected pup counts by combining the uncertainty in the estimation procedure and the uncertainty of the readers correction. We need to do the same for the final pup abundance estimate which adjusts for missing seals based on the readers corrected data. 

We have combined all the estimates in a list:

```{r eval=TRUE}
QHarp = 0.99          # Correction factor for harp seals
SEQHarp = 0.00014     # Uncertainty of the harp seal correction factor
QHooded = 0.82        # Correction factor for harp seals
SEQHooded = 0.0134    # Uncertainty of the harp seal correction factor

# Correcting for missing seals
estimates = list()

# Harp seal population
# Estimated pup abundance based on raw pup counts
estimates$EstHarpFinal = EstHarp$N/QHarp

# Estimated pup abundance based on readers corrected pup counts
estimates$EstHarpFinalCorr = EstHarpCorr$N/QHarp

#---------------------------------------------------

# Hooded seal population
# Estimated pup abundance based on raw pup counts
estimates$EstHoodedFinal = EstHooded$N/QHooded

# Estimated pup abundance based on readers corrected pup counts
estimates$EstHoodedFinalCorr = EstHoodedCorr$N/QHooded

# Calculating the total uncertainty 
estimates$VarTotalHarp = (1/QHarp)^2*EstHarp$SE^2+(EstHarp$N/QHarp^2)*SEQHarp^2
estimates$VarTotalHooded = (1/QHooded)^2*EstHooded$SE^2+(EstHooded$N/QHooded^2)*SEQHooded^2
estimates$VarTotalHarpCorr = (1/QHarp)^2*VarHarpCorr+(EstHarpCorr$N/QHarp^2)*SEQHarp^2
estimates$VarTotalHoodedCorr = (1/QHooded)^2*VarHoodedCorr+(EstHoodedCorr$N/QHooded^2)*SEQHooded^2
```
We do the same for the GAM estimates:

```{r eval=TRUE}
estimatesGAM = list()
estimatesGAM$EstHarpGAMFinal = EstGAM$NHarpGAM/QHarp
estimatesGAM$EstHarpGAMFinalCorr = EstGAMCorr$NHarpGAM/QHarp
estimatesGAM$EstHoodedGAMFinal = EstGAM$NHoodedGAM/QHooded
estimatesGAM$EstHoodedGAMFinalCorr = EstGAMCorr$NHoodedGAM/QHooded

estimatesGAM$VarTotalHarpGAM = (1/QHarp)^2*EstGAM$VarHarpGAM+(EstGAM$NHarpGAM/QHarp^2)*SEQHarp^2
estimatesGAM$VarTotalHarpGAMCorr = (1/QHarp)^2*VarHarpGAMCorr+(EstGAMCorr$NHarpGAM/QHarp^2)*SEQHarp^2
estimatesGAM$VarTotalHoodedGAM = (1/QHooded)^2*EstGAM$VarHoodedGAM+(EstGAM$NHoodedGAM/QHooded^2)*SEQHooded^2
estimatesGAM$VarTotalHoodedGAMCorr = (1/QHooded)^2*VarHoodedGAMCorr+(EstGAMCorr$NHoodedGAM/QHooded^2)*SEQHooded^2
```


In summary we now have both uncorrected and readers corrected pup counts (for both populations), we have pup abundance estimates (both populations, and based on both corrected and uncorrected pup counts), we got a correction factor for pups not born yet and pups that have already left the ice, and we got a total uncertainty in the final pup abundance estimate (based on the uncertainty of the readers corrections and the uncertainty of the correction factor from the birth distribution). 

With the list we can print out the final results to the screen. 

For the Kingley method:
```{r eval=TRUE}
#Print pup production estimates based on the Kingsley method to screen
printKingsley2screen(estimates)
```

For the GAM method:
```{r eval=TRUE}
#Print pup production estimates based on the GAM method to screen
printGAM2screen(estimatesGAM)
```

## Appendix

This was done by using information on the proportion of pups in seven distinct age-dependent stages. These easily recognizable descriptive age categories were based on pelage colour and body condition, overall appearance, and muscular coordination, as described for the northwest Atlantic harp seals by [@Stewart1980]:

1. Newborn: Pup still wet, bright yellow colour often present. Often associated with wet placentas and blood stained snow. 
2. Yellowcoat: Pup dry, yellow amniotic stain still persistent on pelt. The pup is lean and moving awkwardly.
3. Thin whitecoat: Amniotic stain faded, pup with visible neck and often conical in shape, pelage white.
4. Fat whitecoat: Visibly fatter, neck not visible, cylindrical in shape, pelage still white.
5. Greycoat: Darker juvenile pelt beginning to grow in under the white lanugo giving a grey cast to the pelt, “salt-and-pepper”-look in later stages. 
6. Ragged-jackets: Lanugo shed in patches, at least a handful from torso (nose, tail and flippers do not count). 
7. Beaters: Fully moulted pups (a handful of lanugo may remain).
 
Prior to the survey, classifications of pup stages were standardized among observers to ensure consistency. To determine the proportion of pups in each stage on a given day, random samples of pups were obtained by flying a series of transects over the patch. Pups were classified from the helicopter hovering just above the animals. The spacing between transects depended on the size of the actual patch. 

A similar procedure was followed for hooded seals where information on the proportion of pups in each of five distinct age-dependent stages was used to assess the temporal distribution of births. 
These arbitrary, but easily recognizable age categories were based on pelage colour and body condition, overall appearance, and muscular coordination, as described for northwest Atlantic hooded seals by @Bowen1987 and @Stenson1988, and used in the previous surveys in the Greenland Sea [@Salberg2008; @Øigård2010]:

1. Unborn: Parturient females.
2. Newborn: Skin in loose folds along flanks, fur saturated to wet, entire pelage with yellowish hue, awkward body movements. Mother present. Often associated with wet placentas and blood stained snow. 
3. Thin blueback: Pup dry, ventrum white, neck well defined, trunk conical in shape. Mother present. Mainly 1-2 days old.
4. Fat blueback: Ventrum white, neck not distinguishable, trunk fusiform in shape. Mother present. Mainly 2-4 days old.
5. Solitary blueback: As in fat blueback, but mother not present. Mainly 4 days or older.

The temporal distribution of births for both harp and hooded seals was estimated using the method developed in @Reed1968 and adapted for modelling the birth distribution for harp and hooded seals in @Bowen1987, and @Myers1989. The life cycles of the seals were assumed to be divided into $k$ identifiable age-dependent stages $S_1,.....,S_k$. Birth takes place into state $S_1$ and the pup then progresses in succession through states $S_1,S_2,....$  until it attains maturity when reaching state $S_k$. All pups reaching state $S_k$ eventually die in that state, either from hunting or natural causes [@Reed1968]. We assumed that for both seal populations the birth rate could be adequately described by a continuous function of time, $m_1(t)$ which denoted the temporal distribution of births. The distribution of births over time was assumed to be a normal distribution with mean value $\mu_1$ and standard deviation $\sigma_1$.

The various development stages are denoted by the subscript $j$, and a pup passes from stage $j$ to stage $j+1$. The stage durations are specified in terms of transition intensity functions $\phi_j(t)$, which is the probability that an animal passes from stage $j$ to $j+1$ in the interval $[\tau,\tau+\Delta t]$ and has survived. Here $\tau$ is the time spent in stage $j$. The stage duration was assumed to be a semi-Markov process, i.e. the transition intensities depend only on the current stage and the time so far spent in that stage [@Bowen1987]. The rate at which pups enter the stage $j$ at time $t$ were denoted by $m_j(t)$ and given by a recurrence relationship @Myers1989:

$$m_j(t)={\int_0^\infty}m_{j-1}(t-\tau)\phi_{j-1}(\tau)d\tau\quad j=1,..,k$$
 
The proportion of pups that will be observed on the ice in stage $j$ at time $t$ is [@Bowen1987; @Myers1989]:

$$n_j(t)={\int_0^\infty}m_{j-1}(t-\tau)\Biggl(1-{\int_0^\tau}\phi(s)ds\Biggr)d\tau$$
 
This equation assumes no pup morality during these stages and that all pups on the ice are visible. In @Bowen1987, -@Bowen2007 and @Myers1989 the transition intensity functions $\phi_j(t)$ were assumed to follow a Gamma distribution with shape parameter $\kappa_j$ and scale parameter $\rho_j$ for stage $j$. The product between the shape parameter and the scale parameter, $\rho_j\kappa_j$, gives the mean duration of stage $j$. 
The numbers of individuals observed to be of stage $j$ at time $t_i$ were denoted $S_{ij}$. The $S_{ij}$'s were obtained by taking a random sample of the pup abundance and determining the stage of each individual. The predicted proportions of each stage present at time $t_i$,  $P_{ij}$, are calculated as in @Myers1989, i.e. by estimating the parameters $\hat{\mu}_1$ and $\hat{\sigma}_1$ of the birth distribution. The proportion of pups on the ice at time $t$ was estimated using [@Salberg2008; @Øigård2010]:

$$Q(t)={\sum_{j=1}^k}\eta_j(t)$$
 
The estimated variance of the proportion of pups on the ice at a given time was estimated by simulating from the proportion of pups in the various stages obtained from the staging by simulating from a multinomial distribution with $k$ stages [@Salberg2008].

To correct for pups still not born, and pups that had left the ice at the time of the photographic survey, the estimated numbers of pups on the ice at the time of the survey were corrected by:

$$\hat{N}^{corr}=\frac{\hat{N}}{\hat{Q}}$$
 
where $\hat{Q}$ is the estimated proportion of pups visible on the photographs at the time of the survey.

The estimates of $N_i$ and $Q$ are independent and therefore the error variance of the estimated total number of pups born in the patch $\hat{N}^{corr}$ may be obtained using the  $\delta$-method [e.g. @Casella1990]:

$$V^{corr}=\Biggl(\frac{1}{Q}\Biggr)^2V\Biggl(\frac{N}{Q^2}\Biggr)V^q$$
 
where $V^q$ is the estimated variance of  $\hat{Q}$.

To conform to the procedure used in 2012, we used the following binning of the various stages of the harp seal pups:  stage 1 = Newborn/Yellow, stage 2 = Thin white, and stage 3 = Fat white/Greycoat. 

The following binning of the various stages of the hooded seal pups was: stage 1 = Newborn and Thin, stage 2 = Fat, and stage 3 = Solitary. 


<!-- ### Catch data -->
<!-- Catch data are found in the file *catch_data.dat* and the content of the file looks like this: -->

<!--     ##     V1     V2    V3 -->
<!--     ## 1 1946 105631 64742 -->
<!--     ## 2 1947 105631 64742 -->
<!--     ## 3 1948 105631 64742 -->
<!--     ## 4 1949 105631 64742 -->
<!--     ## 5 1950 105631 64742 -->
<!--     ## 6 1951  67793 76448 -->

<!-- The first column contains the year, the seccond column contains the catch of pups, and the third column contains the catch of the 1+ population. -->

<!-- ### Pup production estimates -->
<!-- Estimated pup production is found in the file *pup_production.dat*. The content of the file looks like this:  -->

<!--     ##      V1     V2    V3 -->
<!--     ## 1  1998 286260 0.150 -->
<!--     ## 2  2000 322474 0.098 -->
<!--     ## 3  2000 339710 0.105 -->
<!--     ## 4  2002 330000 0.103 -->
<!--     ## 5  2003 328000 0.181 -->
<!--     ## 6  2004 231811 0.190 -->
<!--     ## 7  2004 234000 0.205 -->
<!--     ## 8  2005 122658 0.162 -->
<!--     ## 9  2008 123104 0.199 -->
<!--     ## 10 2009 157000 0.108 -->
<!--     ## 11 2010 163032 0.198 -->
<!--     ## 12 2013 128786 0.237 -->

<!-- In the first column you see the survey year, in the seccond column you see the estimated pup production, and in the third the estimated CV of that survey is given. -->

<!-- ### Fecundity data -->
<!-- Fecundity data is found in the *fecundity.dat* file. The content of the file looks like this: -->

<!--     ##     V1   V2   V3 -->
<!--     ## 1 1990 0.84 0.06 -->
<!--     ## 2 1991 0.84 0.06 -->
<!--     ## 3 1992 0.84 0.06 -->
<!--     ## 4 1993 0.84 0.06 -->
<!--     ## 5 2006 0.68 0.06 -->
<!--     ## 6 2011 0.84 0.06 -->
<!--     ## 7 2018 0.91 0.03 -->

<!-- In the first column you have the year for when the fecundity is estimated, in the seccond column you have the estimated fecundity, and in the thirst column you have the estimated standard error of the fecundity estimate. -->

<!-- ### Birth ogive -->
<!-- In the files *wgharp.ogi* and *wgharp.ogp* you find the birth ogive data, and the from which time periods the birth ogive curves applies for. The content of the *wgharp.ogi* looks like -->

<!--     ##    Age   P1   P2   P3   P4   P5 -->
<!--     ## 1    1 0.00 0.00 0.00 0.00 0.00 -->
<!--     ## 2    2 0.00 0.00 0.00 0.01 0.00 -->
<!--     ## 3    3 0.01 0.00 0.00 0.02 0.00 -->
<!--     ## 4    4 0.17 0.00 0.02 0.05 0.00 -->
<!--     ## 5    5 0.64 0.24 0.08 0.11 0.00 -->
<!--     ## 6    6 0.90 0.62 0.21 0.25 0.52 -->
<!--     ## 7    7 0.98 0.81 0.40 0.55 0.77 -->
<!--     ## 8    8 0.99 0.91 0.59 0.90 0.89 -->
<!--     ## 9    9 1.00 0.95 0.75 0.99 0.95 -->
<!--     ## 10  10 1.00 0.98 0.85 1.00 0.97 -->
<!--     ## 11  11 1.00 0.99 0.91 1.00 0.99 -->
<!--     ## 12  12 1.00 0.99 0.95 1.00 0.99 -->
<!--     ## 13  13 1.00 1.00 0.97 1.00 0.99 -->
<!--     ## 14  14 1.00 1.00 0.98 1.00 1.00 -->
<!--     ## 15  15 1.00 1.00 0.99 1.00 1.00 -->
<!--     ## 16  16 1.00 1.00 1.00 1.00 1.00 -->
<!--     ## 17  17 1.00 1.00 1.00 1.00 1.00 -->
<!--     ## 18  18 1.00 1.00 1.00 1.00 1.00 -->
<!--     ## 19  19 1.00 1.00 1.00 1.00 1.00 -->
<!--     ## 20  20 1.00 1.00 1.00 1.00 1.00 -->

<!-- In the first column the age group is listed and in the following columns a birth ogive curve is listed for a given period. Every time a new birth ogive estimated is available, a new column is added. The content of the *wgharp.ogp* looks like  -->

<!--     ##   Pstart Pstop -->
<!--     ## 1   1962  1972 -->
<!--     ## 2   1976  1985 -->
<!--     ## 3   1988  1993 -->
<!--     ## 4   2006  2006 -->
<!--     ## 5   2018  2018 -->

<!-- The first column denotes the start of the time period a given birth ogive curve applies for, and the second column denotes the end of the time period the birth ogive curve is valid. The reason for this is that usually data for several years are pooled together when estimating the birth ogive curve in order to ensure enough data to obtain a reasonable estimated of the birth ogive. Note that the number of rows in the *wgharp.ogp* file corresponds to the number of columns in the *wgharp.ogi* file (minus 1 since one column represents the age group). -->

<!-- ### Priors used -->
<!-- Priors used for the various parameters are specified in the *priors.dat* file. The content of the file looks like this: -->

<!--     ##        V1    V2 -->
<!--     ## 1 1.0e+06 2e+05 -->
<!--     ## 2 9.0e-02 5e-02 -->
<!--     ## 3 2.7e-01 5e-02 -->

<!-- Each row specify mean and the standard deviation of a Gaussian prior used for a given parameter. In the first colum the mean value is found and in the second column the standard deviation is found. In the first row the prior distribution of the initial population size $K$ is specified, in the seccond row the prior distribution of the 1+ mortality $M$ is specified, and in the third row the prior distribution of the pup mortality $M_0$ is specified. -->


<!-- ## Loading the full data set -->
<!-- In order to load the data you have to specify which population you want to load the data for. The various alternatives are `harpeast`, `harpwest`, and `hooded` (which is the hooded seal population in the West Ice - the ice along the east coast of Greenland). In the examples that follows we will use the `harpeast` population.  -->

<!-- To load the data used you run the following function: -->
<!-- ```{r eval=FALSE} -->
<!-- data <- load.data(population = "harpeast") -->
<!-- ``` -->

<!-- ```{r echo=FALSE} -->
<!-- data = harpeast$data -->
<!-- parameters = harpeast$parameters -->
<!-- ``` -->

<!-- To explore the data object you can -->
<!-- ```{r} -->
<!-- names(data) -->
<!-- ``` -->

<!-- The data object is a list and you can further explore the actual values used by e.g., -->
<!-- ```{r} -->
<!-- data$Amax -->

<!-- data$pupProductionData -->

<!-- ``` -->

<!-- # Parameters to be estimed and how to load them -->
<!-- As briefly mentioned earlier the population dynamics model is described by three parameters. The initial population size $K$, the mortality of the 1+ population $M$, and the pup mortality $M_0$. The initial population size is the population size for the year the model is fit from, and this is determined by the availability of the catch data. The earliest catch data is from 1946, so the model is fit from 1946 and up to present. It also predicts the population dynamics into the future, and this is default set to 15 years.  -->

<!-- To load the initial values of the parameters to be estimated run: -->
<!-- ```{r eval=FALSE} -->
<!-- parameters <- load.initial.values(population = "harpeast") -->
<!-- ``` -->
<!-- The parameters object is also a list and the content looks like this for the `harpeast` population -->
<!-- ```{r} -->
<!-- parameters -->
<!-- ``` -->
<!-- Here `logK` is the log transformed initial population size, `M0tilde` is the logit transformed pup mortality, and `Mtilde` is the logit transformed 1+ mortality (seals of age 1 and greater). The reason that transformed parameters are estimated instead of the non transformed parameters is that the log transformation of the initial population ensures that the model provides a stricktly positive estimate of the initial population. The logit tranformation of the mortalities ensures that the estimates are bounded between 0 and 1.  -->

<!-- # Model fitting and obtaining estimates -->
<!-- The model is implemented in the Template Model Builder framework and makes use of the `TMB` R package. This means that the code for model is written in C++ and will be compiled when you install the `rSPAMM` package. When installing the `rSPAMM` package the `TMB` package and all dependencies should also be installed automatically. -->

<!-- ## Fitting the population dynamics model -->
<!-- The optimization routine used is `nlminb`.  -->
<!-- To fit the model run: -->

<!-- ```{r} -->
<!-- optobj <- run.model(data = data, par = parameters) -->
<!-- ``` -->

<!-- When the model is fitted some key information will be written to screen. This key information show whether the model converged, what type of convergence and estimates of the parameters that describes the modelled population dynamics. -->

<!-- The `run.model` function returns a list containing the model object `obj` and the final optimized opject `opt`. -->

<!-- ## Obtaining the estimated quantities -->
<!-- In addition to the estimated parameters needed to describe the modelled population dynamics of a population the model fit also provides the user with other relevant quantities. The Table below lists the various quantities obtained. -->

<!-- ---------------------------------------------------- -->
<!-- Variable name           Description -->
<!-- -----------------       ---------------------------- -->
<!-- rep                     Check it out -->

<!-- rep.matrix              Check -->

<!-- rep.names               check -->

<!-- indN0                   Indexes of where the fitted pup population is found in the -->
<!--                         rep.matrix -->

<!-- indN1                   Indexes for the modelled 1+ population -->

<!-- indNtot                 Indexes for  the total population -->

<!-- indD1                   Index for the estimated of D  -->

<!-- indD1new                Index for the estimated D1new -->

<!-- indN0Current            Index for the modelled pup abundance in the current year -->

<!-- indN1Current            Index for the modelled 1+ abundance in the current year -->

<!-- indNtotCurrent          Index for the modelled total population in the current year                      -->

<!-- years                   The years the model is fitted for -->

<!-- Kest                    Estimated initial population size -->

<!-- Kest.sd                 Standard deviation of the initial population size -->

<!-- Mest                    Estimated 1+ mortality -->

<!-- Mest.sd                 Standard deviation of the 1+ mortality -->

<!-- M0est                   Estimated pup mortality -->

<!-- M0est.sd                Standard deviation of the estimated pup mortality -->

<!-- D1                      Estimated depletion coefficient -->

<!-- DNmax                   Estimated of depletion coefficient using Nmax and Npred -->

<!-- N0Current               Estimated pup abundance for the current year -->

<!-- N1Current               Estimated 1+ abundance for the current year -->

<!-- NTotCurrent             Estimated total abundance for the current year -->

<!-- D1.sd                   Standard deviation of estimated D -->

<!-- DNmax.sd                Standard deviation of estimated D using Nmax and Npred -->

<!-- N0Current               Standard deviation of current pup abundance -->

<!-- N1Current               Standard deviation of current 1+ abundanceI -->

<!-- NTotCurrent             Standard deviation of current total abundance -->
<!-- ------------------------------------------------- -->

<!-- The model results can be obtained by running: -->
<!-- ```{r} -->
<!-- res <- model.results(data = data,optobject = optobj) -->
<!-- ``` -->
<!-- The `res` object is a list containing all the estimates of the quantities listed in the Table above. -->

<!-- ```{r} -->
<!-- names(res) -->
<!-- ``` -->

<!-- A table for the most interesting quantities needed can be made by running: -->
<!-- ```{r} -->
<!-- partab <- par.table(results=res, dat=data)  -->

<!-- partab  -->
<!-- ``` -->

<!-- # Visualize the modelled population dynamics -->
<!-- In this section we will show how to create graphics to present the various output of the modelling results. To display the modelled pup abundance and the 1+ abundance you run the following function: -->
<!-- ```{r} -->
<!-- plotRes(res,data) -->
<!-- ``` -->

<!-- *** -->

<!-- **In order to open an OS independent graphical devise use the option `grDev = TRUE`, i.e,** -->
<!-- ```{r eval = FALSE} -->
<!-- plotRes(res,data,grDev = TRUE) -->
<!-- ``` -->

<!-- *** -->


<!-- <!-- ![Modelled pup abundance and 1+ abundance.](figures/fitted_N0_N1_with_projections.png){ width=98%} --> -->


<!-- You can also plot the fit to the pup abundance and the 1+ abundance separately by specifying that in the `component` option: -->
<!-- ```{r} -->
<!-- plotRes(res,data,component = c("N0")) -->
<!-- ``` -->

<!-- *** -->
<!-- <!-- ![Modelled pup abundance.](figures/fitted_pup_abundance.png){ width=98%} --> -->

<!-- ```{r} -->
<!-- plotRes(res,data,component = c("N1")) -->
<!-- ``` -->

<!-- *** -->
<!-- <!-- ![Modelled abundance.](figures/fitted_adult_abun.png){ width=98%} --> -->

<!-- You can also choose to not plot the future projections by setting `projections = FALSE` .  -->
<!-- ```{r} -->
<!-- plotRes(res,data,projections = FALSE) -->
<!-- ``` -->

<!-- *** -->
<!-- <!-- ![Modelled pup and 1+ abundance  withouth projections.](figures/fitted_abun_no_proj.png){ width=98%} --> -->

<!-- The confidence intervals can be turned off by setting `conf.int = FALSE` and the horizontal lines for $N_{lim}$, $N_{50}$ and $N_{70}$ can be turned off by setting `plot.Nlims = FALSE`. For other options you can run `?plotRes`. -->

<!-- If you want to visualize certain types of data you can plot the historical catch level used, the fecundity vector and the birth ogive curves for each time period. To plot the catch data run the `plotCatch()` function: -->
<!-- ```{r eval = FALSE} -->
<!-- plotCatch(catch = data$Cdata) -->
<!-- ``` -->
<!-- ![Reported catch levels of pups and 1+ animals with bars next to each other.](figures/catch_data_dodge_new.png){ width=98%} -->


<!-- *** -->

<!-- Default the bars are next to each other, but the bars can be plotted on top of each other by setting `position = "stack"`: -->
<!-- ```{r eval = FALSE} -->
<!-- plotCatch(catch = data$Cdata,position = "stack") -->
<!-- ``` -->

<!-- ![Reported catch levels of pups and 1+ animals with bars on top of each other.](figures/catch_data_stack_new.png){ width=98%} -->

<!-- *** -->

<!-- You can plot the modelled population dynamics and the reported catch in the same figure using `plotResCatch()` -->

<!-- ```{r eval = FALSE} -->
<!-- plotResCatch(res,data) -->
<!-- ``` -->
<!-- ![Reported catch levels of pups and 1+ animals with bars next to each other.](figures/plotResCatch.png){ width=98%} -->

<!-- *** -->

<!-- If you want to explore the birth ogive data used for various periods you can run the `plotOgive()` function: -->
<!-- ```{r fig.height=4} -->
<!-- plotOgive(dat = data) -->
<!-- ``` -->

<!-- *** -->

<!-- <!-- ![Birth ogive for different periods.](figures/birth_ogive.png){ width=98%} --> -->

<!-- Since fecundity rates is not available for all years they are interpolated between missing years. You can plot the fecundity rates used in the modelling by running `plotFecundity()`. Default it plots both the linear interpolated fecundity rates and the observed fecundity ratesfor a given population. -->
<!-- ```{r fig.height=4} -->
<!-- plotFecundity(dat = data) -->
<!-- ``` -->

<!-- *** -->

<!-- <!-- ![Fecundity rates used in the modelling.](figures/fecundity.png){ width=98%} --> -->


<!-- # Exploring various catch options -->
<!-- In this section we will describe how to explore various catch options such as finding the equilibrium catch level, i.e., the fixed annual catch level that keeps the future projected population abundance constant, finding the catch level that would reduce the population to $N_{70}$ (70% of the current population size) with probability 0.8 over a 15-years period, and Potential Biological Removals (PBR) catch level. -->

<!-- ## Equilibrium catch level -->
<!-- To find the equilibrium catch level we run the function `find.eq.quota()`. -->

<!-- Default is that the function assumes that zero pups are in the catch and that all catch are 1 year old animals or more. To change he proportion of pups and 1+ animals in the catch you use the `quota` variable, i.e., the following finds the equilibrium catch level assuming 15% pups and 85% 1+ animals in the catch: -->
<!-- ```{r} -->
<!-- EquilibriumCatch <- find.eq.quota(data = data, -->
<!--                                   parameters = parameters,  -->
<!--                                   quota = c(0.15,0.85)) -->

<!-- EquilibriumCatch -->
<!-- ``` -->

<!-- You have now found the fixed annual catch level that stabilizes the future 1+ population under the estimated model for the `harpeast` population and can re-run the model using this equilibrium catch level for the future projection. Default in the when running the model fit assumes zero catch for the future predictions. To re-run the model and plot the estimated future trajectory using the equilibrium catch level you run the following code: -->
<!-- ```{r} -->
<!-- #Rerun the model -->
<!-- data$CQuota = EquilibriumCatch -->
<!-- optEq = run.model(data = data, par = parameters) -->
<!-- resEq = model.results(data = data,optobject = optEq) -->

<!-- #Plot model -->
<!-- plotRes(resEq,data) -->
<!-- ``` -->

<!-- *** -->

<!-- ## $N_{70}$ catch level -->
<!-- To find the the catch level that would reduce the population to 70% of the historical maximum observed (modelled) with probability 0.8 over a 15-year period you run the function `find.N70.quota()`: -->
<!-- ```{r} -->
<!-- catchN70 = find.N70.quota(data = data, -->
<!--                           parameters = parameters,  -->
<!--                           quota = c(0,1)) -->
<!-- ``` -->

<!-- For this population it turns out that the current population -->
<!-- size is below $N_{70}$. Because of this there is no point estimating the $N_{70}$ catch level. -->

<!-- This example assume that zero pups are in the catch and that all catch are 1 year old animals or more. To change he proportion of pups and 1+ animals in the catch you use the `quota` variable, i.e., use `quota = c(0.15,0.85)` to find the $N{70}$ catch level assuming 15% pups and 85% 1+ animals in the catch: -->

<!-- If the $N_{70}$ population size was below the current population size you could re-run the model using the estimated $N_{70}$ catch level  -->
<!-- ```{r eval=FALSE} -->
<!-- data$CQuota = catchN70 -->
<!-- optN70 = run.model(data = data, par = parameters) -->
<!-- resN70 = model.results(data = data,optobject = optN70) -->

<!-- #Plot the estimated future trajectory using the N70 catch level -->
<!-- plotRes(resN70,data) -->
<!-- ``` -->

<!-- ## The Potential Biological Removals (PBR) catch level -->
<!-- Potential Biological Removals has been defined as: -->
<!-- $$PBR=\frac{1}{2}R_{max}F_rN_{min},$$ -->
<!-- where $R_{max}$ is the maximum rate of increase for the population (default to 0.12 for pinnipeds), $F_r$ is the recovery factor with values between 0.1 and 1 (default to 0.5), and $N_{min}$ is the estimated population size using 20% percentile of the log-normal distribution. The PBR catch level assumes that the age structure of the removals is proportional to the age composition of the population (i.e. 14% ). To find the PBR catch level using the default parameters you run: -->
<!-- ```{r} -->
<!-- pbrCatch = PBR(n0=partab[4,3],  -->
<!--                n1=partab[5,3],  -->
<!--                se0=partab[4,4],  -->
<!--                se1=partab[5,4]) -->

<!-- pbrCatch -->
<!-- ``` -->



<!-- where n0 is the current population size, n1 is the current 1+ population size, se0 is the standard deviation of the estimated current pup abundance, and se1 is the standard deviation of the estimated current 1+ abundance. Recall from the Table above that these quantities could be found using the `par.tab()` function. -->

<!-- Re-run the model using this catch level -->
<!-- ```{r} -->
<!-- data$Quota = c(pbrCatch$n0catch,pbrCatch$n1catch) -->
<!-- optPBR = run.model(data = data, par = parameters) -->
<!-- resPBR = model.results(data = data,optobject = optPBR) -->

<!-- #Plot the estimated future trajectory using PBR catch level -->
<!-- plotRes(resPBR,data) -->
<!-- ``` -->

<!-- *** -->

<!-- <!-- ![](figures/EqCatch.png){ width=98%} ![](figures/N70catch.png){ width=98%}![](figures/PBR_catch.png){ width=98%} --> -->

<!-- <!-- ![Projections for various catch options. (a) Equilibrium catch level, (b) N70 catch level, and (c) PBR catch level.](figures/CatchOptions.png){ width=98%} --> -->


<!-- # Appendix - NB Does not apply for this package. -->

<!-- ## Complete code for assessment -->
<!-- This section contains a script for a complete analysis of the harp seal population in the East Ice (in the White Sea) using the `rSPAMM` package. -->
<!-- ```{r eval = FALSE} -->
<!-- #Load the rSPAMM package -->
<!-- library(rSPAMM) -->

<!-- ################### -->
<!-- # Data -->
<!-- ################### -->
<!-- # You can choose to use either the demo data which is  -->
<!-- # included in the rSPAMM package or loading the full data -->

<!-- #Use this if analysing the demo data. -->
<!-- #Loading demo data and parameters -->
<!-- data("harpeastDemo") -->
<!-- data = harpeast$data -->
<!-- parameters = harpeast$parameters -->


<!-- #Use this if analysing latest version of the -->
<!-- #complete data set -->
<!-- #Download full data. Default the function will -->
<!-- #ask to create a new folder. If you already have  -->
<!-- #a folder you can add the option  -->
<!-- #"chooseFolder = FALSE". -->
<!-- #Note the Working Directory has to be set to the -->
<!-- #root folder of the downloaded data, i.e., not  -->
<!-- #the Data or the Scripts folder. -->
<!-- downloadData() -->
<!-- #Loading the data -->
<!-- data = load.data(population = "harpeast") -->
<!-- #Loading the parameters -->
<!-- parameters = load.initial.values(population = "harpeast") -->


<!-- ################## -->
<!-- # Model fitting -->
<!-- ################## -->
<!-- #Run the model -->
<!-- optobj = run.model(data = data, par = parameters) -->

<!-- #Obtain the results -->
<!-- res = model.results(data = data,optobject = optobj) -->

<!-- #Create a nice table with the results -->
<!-- partab = par.table(results=res, dat=data)  -->

<!-- #Plot the results (both the pup model fit and the N1+ population) -->
<!-- plotRes(res,data,grDev = TRUE) -->


<!-- ################## -->
<!-- # Catch options -->
<!-- ################## -->

<!-- #Find the equilibrium catch level -->
<!-- #In this example we are assuming 15% pups  -->
<!-- #and 85% 1+ animals in the catch -->
<!-- EquilibriumCatch = find.eq.quota(data = data, -->
<!--                                  parameters =parameters, -->
<!--                                  quota = c(0.15,0.85)) -->

<!-- #Rerun the model using the estimated equilibrium catch level -->
<!-- data$CQuota = EquilibriumCatch -->
<!-- optEq = run.model(data = data, par = parameters) -->
<!-- resEq = model.results(data = data,optobject = optEq) -->

<!-- #Plot the estimated future trajectory using equilibrium catch level -->
<!-- plotRes(resEq,data,grDev = TRUE) -->

<!-- #-------------------------- -->

<!-- #Find the N70 catch level -->
<!-- catchN70 = find.N70.quota(data = data, -->
<!--                           parameters = parameters,  -->
<!--                           quota = c(0,1)) -->

<!-- #For this population it turns out that the current population -->
<!-- #size is below N70. Because of this there is no point estimating -->
<!-- #the N70 catch level. -->

<!-- #If the current population size was above N70 you could -->
<!-- #rerun the model using the estimated N70 catch level -->
<!-- data$CQuota = catchN70 -->
<!-- optN70 = run.model(data = data, par = parameters) -->
<!-- resN70 = model.results(data = data,optobject = optN70) -->

<!-- #Plot the estimated future trajectory using the N70 catch level -->
<!-- plotRes(resN70,data,grDev = TRUE) -->

<!-- #-------------------------- -->

<!-- #Find the PBR catch level -->
<!-- #In this example we are assuming 14% pups  -->
<!-- #and 86% 1+ animals in the catch -->
<!-- pbrCatch = PBR(n0=partab[4,3],  -->
<!--                n1=partab[5,3],  -->
<!--                se0=partab[4,4],  -->
<!--                se1=partab[5,4]) -->

<!-- #Re-run the model using the PBR catch level -->
<!-- data$CQuota = c(pbrCatch$n0catch,pbrCatch$n1catch) -->
<!-- optPBR = run.model(data = data, par = parameters) -->
<!-- resPBR = model.results(data = data,optobject = optPBR) -->

<!-- #Plot the estimated future trajectory using PBR catch level -->
<!-- plotRes(resPBR,data,grDev = TRUE) -->
<!-- ``` -->

<!-- ## The population dynamics model -->
<!-- The population model is an age-structured population dynamics model. For initiation of the model it is assumed that the population had a stable age structure in year $y_0 = 1945$, i.e., -->
<!-- $$ -->
<!-- N_{i,y_0} = N_{y_0}s_{1+}^{i-1}(1-s_{1+}), \quad i = 1,\ldots,A-1, -->
<!-- $$ -->
<!-- $$ -->
<!-- N_{A,y_0}=N_{y_0}s_{1+}^{A-1}. -->
<!-- $$ -->
<!-- Here $A$ is the maximum age group containing seals aged $A$ and higher, and set to 20 years, and $N_{y_0}$ is the estimated initial population size in year $y_0$. The model is parameterized by the natural mortalities $M_0$ and $M_{1+}$ for the pups and seals of 1 year and older, respectively. These mortalities determine the survival probabilities $s_0 = \exp(-M_0)$ and $s_{1+} = \exp(-M_{1+})$. -->

<!-- The model has the following set of recursion equations: -->
<!-- $$ -->
<!-- N_{a,y}=\left(N_{0,y-1}-C_{0,y-1}\right)s_0, -->
<!-- $$ -->
<!-- $$ -->
<!-- N_{a,y}=\left(N_{a-1,y-1}-C_{a-1,y-1}\right)s_{1+},\quad a=2,\ldots,A-1, -->
<!-- $$ -->
<!-- $$ -->
<!-- N_{A,y}=\left[\left(N_{A-1,y-1}-C_{a-1,y-1}\right)+\left(N_{A,y-1}-C_{A,y-1}\right)\right]s_{1+}. -->
<!-- $$ -->
<!-- Since available data do not allow for more detailed age-dependence in survival to be estimated it is assumed that the mortality rates are age-independent within the 1+ group. The $C_{a,y}$ are the age-specific catch numbers. Catch records are aggregated over age, and only provide information about the annual number of pups and number of 1+ seals caught. To obtain $C_{a,y}$ we assume that the age-distribution in the catch follows the modelled age distribution and employ *pro rata* rules in the model: -->
<!-- $$ -->
<!-- C_{a,y} = C_{1+,y}\frac{N_{a,y}}{N_{1+,y}},\quad a = 1,\ldots,A. -->
<!-- $$ -->

<!-- where $N_{1+,y} = \sum_{y=1}^A N_{a,y}$, with $N_{a,y}$ being the number of individuals ate age $a$ in year $y$. -->


<!-- The modelled pup abundance is given by -->
<!-- $$ -->
<!-- N_{0,y}=\frac{F_y}{2}\sum_{a=1}^Ap_{a,y}N_{a.y}, -->
<!-- $$ -->

<!-- where $N_{a,y}/2$ is the number of females ate age $a$ in year $y$, $F_y$ is the time-varying fecundity rates and $p_{a,y}$ are the time-varying age specific proportions of mature females. -->

<!-- The model is fitted to the survey pup production estimates and the fecundity rates by maximum likelihood. Assuming normality for the pup production estimates, their contribution to the log-likelihood function is -->
<!-- $$ -->
<!-- \sum_y-\log(\sigma_{0,y})-\frac{1}{2}\frac{\left(N_{0,y}-n_{0,y}\right)^2}{\left(\sigma_{0,y}\right)^2}, -->
<!-- $$ -->
<!-- where $n_{0,y}$ and $\sigma_{0,y}$ denote the survey pup production count and corresponding standard error for year $y$.  -->

<!-- The model has a Bayesian flavour as priors are imposed on some of the parameters. A vague normal prior is assumed for the initial population size $N_{y_0}$. A truncated normal prior was used for both the pup mortalities $M_0$ and $M_{1+}$. -->

<!-- All parameter estimates are found by maximizing the likelihood function using the R package `TMB`. -->
